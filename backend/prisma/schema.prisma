generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id       Int     @id @default(autoincrement())
  password String
  name     String
  email    String  @unique
  deptId   Int?
  position String?
  role     String?
}

model Organization {
  id                      Int                           @id @default(autoincrement())
  name                    String
  parentId                Int?                          @map("parent_id")
  startDate               DateTime                      @map("start_date") @db.Date
  endDate                 DateTime?                     @default(dbgenerated("'9999-12-31'::date")) @map("end_date") @db.Date
  desc                    String?
  regTime                 DateTime                      @default(now()) @map("reg_time")
  employeesAsOrganization Employee[]                    @relation("EmployeeDepartment")
  employee                Employee[]
  employeesAsTeam         Employee[]                    @relation("EmployeeTeam")
  historiesAsOrganization EmployeeOrganizationHistory[] @relation("DepartmentRelation")
  historiesAsTeam         EmployeeOrganizationHistory[] @relation("TeamRelation")
  parent                  Organization?                 @relation("OrganizationToParent", fields: [parentId], references: [id])
  children                Organization[]                @relation("OrganizationToParent")
  projectsAsOrganization  Project[]                     @relation("EmployeeDepartment")
  projectsAsTeam          Project[]                     @relation("EmployeeTeam")

  @@index([parentId])
  @@index([startDate, endDate])
  @@index([name])
  @@map("organization")
}

model Employee {
  seq                         Int                           @default(autoincrement()) @map("seq")
  id                          String                        @unique @map("id")
  no                          String                        @unique @map("employee_no")
  nameKr                      String                        @map("name_kr")
  nameEn                      String?                       @map("name_en")
  nameCh                      String?                       @map("name_zh")
  residentNo                  String                        @unique @map("resident_no")
  password                    String
  birthDate                   DateTime                      @map("birth_date") @db.Date
  isLunar                     Boolean                       @default(false) @map("is_lunar")
  gender                      String                        @default("UNKNOWN") @map("gender")
  departmentId                Int?                          @map("department_id")
  teamId                      Int?                          @map("team_id")
  deptId                      Int?                          @map("dept_id")
  jobLevel                    String?                       @map("job_level")
  jobRole                     String?                       @map("job_role")
  assignStatus                String?                       @map("assign_status")
  authLevel                   String                        @default("USER") @map("auth_level")
  email                       String?
  joinDate                    DateTime                      @map("join_date") @db.Date
  exitDate                    DateTime?                     @map("exit_date") @db.Date
  phone                       String?
  assets                      Asset[]
  ownedFiles                  Attachment[]                  @relation("EmployeeFiles")
  uploadedFiles               Attachment[]                  @relation("UploadedFiles")
  certificates                Certificate[]
  department                  Organization?                 @relation("EmployeeDepartment", fields: [departmentId], references: [id])
  dept                        Organization?                 @relation(fields: [deptId], references: [id])
  team                        Organization?                 @relation("EmployeeTeam", fields: [teamId], references: [id])
  employeeDetail              EmployeeDetail?
  employeeMonthlyMms          EmployeeMonthlyMm[]
  employeeOrganizationHistory EmployeeOrganizationHistory[]
  employeeTool                EmployeeTool?
  preProjectAssignments       PreProjectAssignment[]
  previousExperiences         PreviousExperience[]
  projectAssignments          ProjectAssignment[]
  technicalAbility            TechnicalAbility?

  @@index([id])
  @@index([no])
  @@index([departmentId, teamId])
  @@index([nameKr])
  @@index([assignStatus, authLevel])
  @@index([joinDate])
  @@map("employee")
}

model EmployeeDetail {
  id                Int         @id @default(autoincrement())
  employeeId        String      @unique @map("employee_id")
  type              String      @default("정규직") @map("type")
  hrStatus          String      @default("재직") @map("hr_status")
  skillLevel        String      @default("초급") @map("skill_level")
  leaveStartDate    DateTime?   @map("leave_start_date") @db.Date
  leaveEndDate      DateTime?   @map("leave_end_date") @db.Date
  eduLevel          String?     @map("edu_level")
  lastSchool        String?     @map("last_school")
  major             String?
  entranceDate      DateTime?   @map("entrance_date") @db.Date
  graduationDate    DateTime?   @map("graduation_date") @db.Date
  totalSwExperience Int?        @default(0) @map("total_sw_experience")
  prevSwExperience  Int?        @default(0) @map("prev_sw_experience")
  maritalStatus     String?     @map("marital_status")
  weddingAnniv      DateTime?   @map("wedding_anniv") @db.Date
  emergencyPhone    String?     @map("emergency_phone")
  emergencyRelation String?     @map("emergency_relation")
  zipCode           String?     @map("zip_code")
  address           String?
  addressDetail     String?     @map("address_detail")
  remarks           String?     @map("remarks")
  profilePath       String?     @map("profile_path")
  commonCodeId      Int?
  CommonCode        CommonCode? @relation(fields: [commonCodeId], references: [id])
  employee          Employee    @relation(fields: [employeeId], references: [id])

  @@map("employee_detail")
}

model EmployeeOrganizationHistory {
  id           Int           @id @default(autoincrement())
  employeeId   String        @map("employee_id")
  departmentId Int           @map("department_id")
  teamId       Int?          @map("team_id")
  jobLevel     String?       @map("job_level")
  jobRole      String?       @map("job_role")
  applyDate    DateTime      @map("apply_date") @db.Date
  regTime      DateTime      @default(now()) @map("reg_time")
  department   Organization  @relation("DepartmentRelation", fields: [departmentId], references: [id])
  employee     Employee      @relation(fields: [employeeId], references: [id])
  team         Organization? @relation("TeamRelation", fields: [teamId], references: [id])

  @@map("employee_organization_history")
}

model PreviousExperience {
  id                Int       @id @default(autoincrement()) @map("id")
  employeeId        String    @map("employee_id")
  companyName       String    @map("company_name")
  department        String?   @map("department")
  jobLevel          String?   @map("jobLevel")
  jobRole           String?   @map("job_role")
  relevance         String    @default("유관") @map("relevance")
  entranceDate      DateTime  @map("entrance_date") @db.Date
  resignationDate   DateTime? @map("resignation_date") @db.Date
  assignedTask      String?   @map("assigned_task")
  resignationReason String?   @map("resignation_reason")
  regTime           DateTime  @default(now()) @map("reg_time")
  employee          Employee  @relation(fields: [employeeId], references: [id])

  @@index([employeeId])
  @@map("previous_experience")
}

model Asset {
  id             Int        @id @default(autoincrement())
  employeeId     String?    @map("employee_id")
  name           String
  typeId         String?    @map("type_id")
  vendor         String?
  model          String?
  number         String?
  serialNo       String?    @map("serial_no")
  purchaseDate   DateTime?  @map("purchase_date") @db.Date
  purchaseAmount Decimal?   @map("purchase_amount") @db.Decimal(12, 2)
  warrantyDate   DateTime?  @map("warranty_date") @db.Date
  status         String?
  assignDate     DateTime?  @map("assign_date") @db.Date
  registDate     DateTime   @default(now()) @map("regist_date")
  assetTypeId    Int?
  assetType      AssetType? @relation(fields: [assetTypeId], references: [id])
  employee       Employee?  @relation(fields: [employeeId], references: [id])

  @@map("assets")
}

model AssetType {
  id       Int      @id @default(autoincrement())
  name     String
  isActive Boolean  @default(true) @map("is_active")
  regTime  DateTime @default(now()) @map("reg_time")
  assets   Asset[]

  @@map("assets_type")
}

model Customer {
  id         Int               @id @default(autoincrement())
  name       String
  businessNo String            @unique @map("business_no")
  ceoName    String?           @map("ceo_name")
  industry   String?
  tel        String?
  fax        String?
  address    String?
  homepage   String?
  status     String            @default("활성") @map("status")
  remarks    String?           @map("remarks")
  regTime    DateTime          @default(now()) @map("reg_time")
  contacts   CustomerContact[]
  projects   Project[]

  @@map("customer")
}

model CustomerContact {
  id              Int              @id @default(autoincrement())
  name            String
  email           String?
  phone           String?
  tel             String?
  jobRole         String?
  department      String?
  remarks         String?          @map("remarks")
  customerId      Int              @map("customer_id")
  isPrimary       Boolean          @default(false) @map("is_primary")
  regTime         DateTime         @default(now()) @map("reg_time")
  customer        Customer         @relation(fields: [customerId], references: [id], onDelete: Cascade)
  projectContacts ProjectContact[]

  @@map("customer_contact")
}

model ProjectContact {
  id        Int             @id @default(autoincrement())
  projectId Int             @map("project_id")
  contactId Int             @map("contact_id")
  regTime   DateTime        @default(now()) @map("reg_time")
  contact   CustomerContact @relation(fields: [contactId], references: [id], onDelete: Cascade)
  project   Project         @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@unique([projectId, contactId])
  @@map("project_contact")
}

model TechnicalAbility {
  employeeId         String   @id @map("employee_id")
  communicationSkill String?  @map("communication_skill")
  officeSkill        String?  @map("office_skill")
  testDesign         String?  @map("test_design")
  testExecution      String?  @map("test_execution")
  regTime            DateTime @default(now()) @map("reg_time")
  employee           Employee @relation(fields: [employeeId], references: [id])

  @@map("technical_ability")
}

model EmployeeTool {
  employeeId       String   @id @map("employee_id")
  defectSystem     String?  @map("defect_system")
  messenger        String?  @map("messenger")
  apiTool          String?  @map("api_tool")
  etcTool          String?  @map("etc_tool")
  updatregDateedAt DateTime @updatedAt @map("reg_date")
  employee         Employee @relation(fields: [employeeId], references: [id])

  @@map("employee_tool")
}

model PreProjectAssignment {
  id           Int       @id @default(autoincrement())
  employeeId   String    @map("employee_id")
  projectName  String    @map("project_name")
  customerName String?   @map("client_name")
  startDate    DateTime  @map("start_date") @db.Date
  endDate      DateTime? @map("end_date") @db.Date
  headcount    Int?      @default(0)
  taskName     String?   @map("task_name")
  taskSummary  String?   @map("task_summary")
  assignedRole String?   @map("assigned_role")
  tools        String?   @map("tools")
  workDetail   String?   @map("work_detail")
  contribution String?
  regTime      DateTime  @default(now()) @map("reg_time")
  employee     Employee  @relation(fields: [employeeId], references: [id])

  @@map("pre_project_assignment")
}

model Project {
  id                Int                 @id @default(autoincrement())
  name              String
  customerId        Int?                @map("customer_id")
  departmentId      Int?                @map("department_id")
  teamId            Int?
  regTime           DateTime            @default(now()) @map("reg_time")
  startDate         DateTime?           @map("start_date") @db.Date
  endDate           DateTime?           @map("end_date") @db.Date
  headcount         Int?                @default(0)
  amount            Decimal             @db.Decimal(15, 2)
  status            String?
  location          String?
  taskName          String?             @map("task_name")
  taskSummary       String?             @map("task_summary")
  remarks           String?             @map("remarks")
  customer          Customer?           @relation(fields: [customerId], references: [id])
  department        Organization?       @relation("EmployeeDepartment", fields: [departmentId], references: [id])
  team              Organization?       @relation("EmployeeTeam", fields: [teamId], references: [id])
  projectAssignment ProjectAssignment[]
  projectContacts   ProjectContact[]

  @@unique([customerId, name])
  @@index([customerId])
  @@index([departmentId])
  @@index([startDate, endDate])
  @@index([regTime])
  @@map("project")
}

model ProjectAssignment {
  id                      Int                       @id @default(autoincrement())
  projectId               Int                       @map("project_id")
  employeeId              String                    @map("employee_id")
  startDate               DateTime                  @map("start_date") @db.Date
  endDate                 DateTime?                 @map("end_date") @db.Date
  assignedRole            String?                   @map("assigned_role")
  tools                   String?
  workDetail              String?                   @map("work_detail")
  contribution            String?
  employee                Employee                  @relation(fields: [employeeId], references: [id])
  project                 Project                   @relation(fields: [projectId], references: [id])
  projectAssignmentPeriod ProjectAssignmentPeriod[]

  @@map("project_assignment")
}

model ProjectAssignmentPeriod {
  id           Int               @id @default(autoincrement())
  assignmentId Int               @map("assignment_id")
  status       String?
  startDate    DateTime          @map("start_date") @db.Date
  endDate      DateTime?         @map("end_date") @db.Date
  regTime      DateTime          @default(now()) @map("reg_time")
  assignment   ProjectAssignment @relation(fields: [assignmentId], references: [id])

  @@map("project_assignment_period")
}

model EmployeeMonthlyMm {
  id           Int      @id @default(autoincrement())
  employeeId   String   @map("employee_id")
  yearMonth    String   @map("year_month")
  startDate    DateTime @map("start_date") @db.Date
  endDate      DateTime @map("end_date") @db.Date
  assignStatus String?
  value        Decimal  @db.Decimal(5, 2)
  regTime      DateTime @default(now()) @map("reg_time")
  employee     Employee @relation(fields: [employeeId], references: [id])

  @@map("employee_monthly_mm")
}

model CommonCode {
  id             Int              @id @default(autoincrement()) @map("id")
  type           String           @map("type")
  code           String           @map("code")
  name           String           @map("name")
  isUsed         Boolean          @default(true) @map("is_used")
  regTime        DateTime         @default(now()) @map("reg_time")
  EmployeeDetail EmployeeDetail[]

  @@unique([type, code])
  @@map("common_code")
}

model Certificate {
  id               Int          @id @default(autoincrement()) @map("id")
  employeeId       String       @map("employee_id")
  type             String       @map("cert_type")
  name             String       @map("cert_name")
  issuingAuthority String       @map("issuing_authority")
  acquisitionDate  DateTime     @map("acquisition_date")
  expDate          DateTime?    @map("exp_date")
  regTime          DateTime     @default(now()) @map("reg_time")
  attachments      Attachment[]
  employee         Employee     @relation(fields: [employeeId], references: [id])

  @@map("certificate")
}

model Attachment {
  id            Int          @id @default(autoincrement()) @map("id")
  employeeId    String       @map("employee_id")
  refId         Int?         @map("ref_id")
  refType       String       @map("ref_type")
  fileType      String       @map("file_type")
  filePath      String       @map("file_path") @db.VarChar(500)
  fileName      String
  uploaderId    String       @map("uploader_id")
  certificateId Int?
  certificate   Certificate? @relation(fields: [certificateId], references: [id])
  employee      Employee     @relation("EmployeeFiles", fields: [employeeId], references: [id])
  uploader      Employee     @relation("UploadedFiles", fields: [uploaderId], references: [id])

  @@map("attachment")
}
