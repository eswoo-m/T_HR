                              // default period인 경우
                              // 이미 allocationPeriods가 있으면 첫 번째 period를 선택
                              if (selectedMemberForAllocation.allocationPeriods && selectedMemberForAllocation.allocationPeriods.length > 0) {
                                const firstPeriod = selectedMemberForAllocation.allocationPeriods[0];
                                setEditingPeriodId(firstPeriod.id);
                                setNewPeriodStartDate(firstPeriod.startDate);
                                setNewPeriodEndDate(firstPeriod.endDate);
                                setNewPeriodCategory(firstPeriod.category);
                                
                                setTimeout(() => {
                                  document.querySelector('.period-edit-section')?.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                                }, 100);
                              } else {
                                // allocationPeriods가 없으면 자동으로 추가
                                const newPeriod = {
                                  id: Date.now().toString(),
                                  startDate: selectedMemberForAllocation.startDate || formData.startDate,
                                  endDate: selectedMemberForAllocation.endDate || formData.endDate,
                                  category: data.category
                                };
                                
                                const updatedAssignedMembers = assignedMembers.map(m => {
                                  if (m.code !== selectedMemberForAllocation.code) return m;
                                  return {
                                    ...m,
                                    allocationPeriods: [newPeriod]
                                  };
                                });
                                
                                setAssignedMembers(updatedAssignedMembers);
                                
                                // 선택된 멤버 업데이트
                                const updatedSelectedMember = updatedAssignedMembers.find(m => m.code === selectedMemberForAllocation.code);
                                if (updatedSelectedMember) {
                                  setSelectedMemberForAllocation(updatedSelectedMember);
                                  
                                  // 월별 데이터 재생성
                                  const allocations = generateMonthlyAllocationsFromPeriods(
                                    updatedSelectedMember.allocationPeriods || [],
                                    parseInt(updatedSelectedMember.allocationRate) || 100,
                                    formData.startDate,
                                    formData.endDate
                                  );
                                  setMonthlyAllocations(allocations);
                                  
                                  // 수정 모드로 전환
                                  setEditingPeriodId(newPeriod.id);
                                  setNewPeriodStartDate(newPeriod.startDate);
                                  setNewPeriodEndDate(newPeriod.endDate);
                                  setNewPeriodCategory(newPeriod.category);
                                  
                                  setTimeout(() => {
                                    document.querySelector('.period-edit-section')?.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                                  }, 100);
                                  
                                  toast.success('투입 기간이 추가되었습니다.');
                                }
                              }
